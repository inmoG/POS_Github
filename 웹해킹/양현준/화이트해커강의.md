# 보안 
- 가치가 있는 자산을 보호하는 것
<br></br>

# 자산의 종류 
- **하드웨어** : 컴퓨터, 주변기기, 네트워크 장비 등<br></br>
- **소프트웨어** : 운영체제, 상용프로그램, 직접 개발한 프로그램 등<br></br>
- **데이터** : 문서, 사진, 미디어파일, 이메일, 소스코드 등<br></br>
<br></br>

# 보안취약점 
- 정보보안의 3요소 중 최소 한가지 영향을 미치는 소프트웨어 버그
<br></br>

# 정보보안의 3요소
- **기밀성** ex)패스워드 노출, 카드 정보 노출<br></br>
- **무결성** ex)파일 변조 및 삭제, 웹사이트 디페이스<br></br>
- **가용성** ex)서비스거부공격(DOS)
<br></br>

# CVE
- MITRE에서 관리<br></br>
- 공개된 보안취약점 데이터베이스<br></br>
- **CVE ID** : 보안취약점 식별 번호(예. CVE-2016-5195)<br></br>
- 보안취약점을 추적하고 관리하는데 용이함
<br></br>

# CVSS
- CVSS2=10.0/AV:N/AC:L/Au:N/C:C/I:C/A:C<br></br>
- AV(공격 경로) : 로컬(L), 인접네트워크(A), 네트워크/리모트(N)<br></br>
- AC(공격 난이도) : 하이(H), 미디엄(M), 로우(L)<br></br>
- Au(인증 필요) : 멀티플(M), 싱글(S), 인증필요없음(N)<br></br>
- C(기밀성 영향도) : 없음(None), 부분(Partial), 완전(Complete)<br></br>
- I(무결성 영향도) : N, P, C<br></br>
- A(가용성 영향도) : N, P, C
<br></br>

# 해킹의 기초 단계
- **정보수집**<br></br>
  - 1.정찰(reconnaissance)<br></br>					
  - 2.스캐닝 및 취약점 분석(scanning and enumeration)<br></br>      

- **공격(익스플로잇)**<br></br>
  - 3.침투(gaining access)
<br></br>
- **포스트 익스플로잇**<br></br>
  - 4.권한상승(privilege escalation)<br></br>
  - 5.백도어 관리(maintaining access)<br></br>
  - 6.흔적지우기(cover tracks)
<br></br>

# 악성코드(Malware)
- 악의적인 목적을 가지고 제작된 코드/소프트웨어<br></br>
- Malware = Malicious + softWare<br></br>
- **공격대상** : 특정인, 특정 그룹, 불특정다수<br></br>
- **악성코드의 종류**
  - 바이러스, 트로이 목마, 웜<br></br>
  - 랜섬웨어, 키로거, 애드웨어<br></br>
  - 백도어, 루트킷
<br></br>

# 랜섬웨어(Ransomware)
- **랜섬** = ransom, 몸값<br></br>
- 중요한 파일을 암호화하여 사용을 못하게 만든 후 금전 요구
<br></br>

# 랜섬웨어 예방 방법
- 중요 파일 백업<br></br>
- 중요 파일을 읽기전용으로 변경<br></br>
- OS, 소프트웨어 최신 업데이트<br></br>
- 백신 프로그램 설치
<br></br> 

# APT
- 지능적 지속 위협<br></br>
- 장기간에 걸쳐 지속적으로 공격 수행<br></br>
- 금전적, 정치적 등 다양한 목적<br></br>
- 다양한 해킹 기법을 종합 사용하여 특정 대상을 집중 공격<br></br>
- 조직적으로 수행 가능
<br></br>

# APT대응
- 네트워크 망 분리<br></br>
- 방화벽, IDS/IPS, 웹 방화벽 등 보안장비 배치<br></br>
- 시스템 업데이트 정책 수립<br></br>
- 사내 직원 보안인식교육 및 직원 시스템 관리<br></br>
- NAC 등을 이용한 내부 사용자의 접근 권한 제어<br></br>
- 하드디스크 암호화<br></br>
- 외부 모의해킹 서비스 수행
<br></br>

# 바인드쉘
- 타겟쪽에 서버포트가 열리고 해커쪽에서 타겟쪽으로 접속하여 생성시키는 쉘
<br></br>

# 리버스쉘
- 해커가 서버포트를 열고 타겟에서 해커쪽으로 접속하여 생성시키는 쉘
<br></br>

# 리버스쉘을 사용하는 이유
- 방화벽 때문, ex) 웹서버를 사용하는 경우 80, 443 포트만 열리고 나머지는 다 닫는데 그렇게 되면 80, 443은 사용중이고 나머진 다 닫혔으니 쉘을 열수가 없다 그래서 리버스쉘을 사용한다.

# 정보수집
# 패시브 스캐닝
**이메일 수집(theHarvester)**
- 원하는 사이트에 원하는 검색엔진으로 어떤 이메일들이 유출됬나 검색<br></br>
**이메일 수집(recon-ng)**
- 직원에 이메일을 알아낼 때 사용<br></br>
- **차이** : theHarvester는 구글같은 검색엔진에 나와있는 이메일을 찾는 것, recon-ng는 후이즈 서버에 나와있는 정보로 이메일 찾음
<br></br>

# 액티브 스캐닝
- 공격 대상을 직접 스캔<br></br>
- 이미 공개되어 있는 정보를 이용하여 정보수집<br></br>
- WHOIS(), NETCRAFT(인터넷에서 운영되는 웹서버의 정보를 알아낼 때)<br></br>
- 해커의 활동이 드러나지 않는다.<br></br>
- 대표적인 액티브 스캐닝 기법<br></br>
  - DNS정보수집, 포트스캐닝, 웹스캐닝, 종합 취약점 스캐닝
<br></br>

# SHODAN
- IOT기기 서버들의 정보들을 해킹할 때 주로 사용
<br></br>

# 포트 스캐닝
- /etc/services에 서비스와 포트번호가 정의되어있음<br></br>
-한 포트당 한개의 서비스만 작동
<br></br>
- **Nmap**
  - 기본 틀 nmap [-옵션] [스캔 할 IP]
  - 포트 스캐닝은 대부분 Nmap을 사용한다<br></br>
  - 일반 사용자의 경우 아무 옵션을 주지않고 입력하게 되면 커넥트 스캐닝을 이용해 포트스캐닝을 수행함(-sT 옵션과 동일)<br></br>
  - 루트 사용자의 경우엔 SYN scanning을 사용한다(-sS 옵션과 동일)<br></br>
  - SYN scanning은 3-way handshaking의 전체과정을 거치지 않고 SYN-ACK만 동작되도 포트가 열렸다고 보는기법이다.<br></br>
  - UDP 스캔을 하려면 -sU 옵션을 주면되나 속도가 느리다. UDP 패킷 응답여부를 체크하기 때문에 응답하지 않는 경우 기다려야 하기 때문이다.<br></br>
  - 포트지정(-p), 범위로도 가능<br></br>
  - 대상의 운영체제 정보(-O)<br></br>
  - 버너정보(-Sv)<br></br>
  - 전제적인 정보(-A)<br></br>
 
 # SMTP 정보 수집
- 간편하게 사용 하는 SMTP 사용법(smtp-user-enum -h)<br></br>
- 모드 선택(-m)<br></br>
- 사용자 유무(-u)<br></br>
- username에 대한 파일(-U)<br></br>
- smtp가 실행중인 호스트 IP(-t)<br></br>

# 웹 스캐닝
## nikto
- 명령어<br></br>
  -H 명령어 확인<br></br>
  -h 타겟주소<br></br>
  -o 출력 결과 저장 파일 지정<br></br>
  -C 목표 웹 서버의 CGI 디렉터리 지정<br></br>
  -config 설정 파일 지정<br></br>
  -update nikto 업데이트<br></br>
  -port 포트지정<br></br>
  -cookie 쿠키표시<br></br>
  -ssl sll을 사용하는 타겟에 사용<br></br> 

## legion
- 원래는 sparta를 실습해볼라 했지만 필자는 2019년 버전에 오류가 있어 2020 버전으로 진행하고 있음
- 2020버전에서는 sparta가 없어지고 동일한 기능이 있는 legion으로 대체되어 legion으로 실습 진행함<br></br><br></br> 

- 기능과 구조는 거의 같고 legion에 몇가지 기능이 추가 되었다. 한번 스캔을 해보자면<br></br> 
![](https://postfiles.pstatic.net/MjAyMDExMjBfMjE1/MDAxNjA1ODQ3NTQyNDYz.a_UE4YaYdDdirSCoXrowBe0rBYtJ4MRVCbhjkEbpXyUg.cCJKb4Z14zMPRKat08iBIbLwkfhPUYZddx7mbsepSbog.PNG.depeix/image.png?type=w966)<br></br> 

- ip나 ip대역을 입력하여 스캔할 대상을 정해준다.<br></br> 
![](https://postfiles.pstatic.net/MjAyMDExMjBfNjcg/MDAxNjA1ODQ3Nzk0ODI5.fPJtgrIL0jE5-7RVqsc7wsXNZ6-Un6AU6ux1jNdijhUg.hyNy9nJQkfIozFnRT8HCwgQ62Jh7RCUHcE_mfASVDLUg.PNG.depeix/image.png?type=w966)<br></br> 

- 포트스캐닝 결과와 nmap에서 -sV -o 의 내용들을 보기 편하게 나열해준다.<br></br> 
![](https://postfiles.pstatic.net/MjAyMDExMjBfMTY0/MDAxNjA1ODQ3OTgyNjYx.RAa1I9cFNUmfY-NPoeWxFy2iNq_y_wZEsDKGL-bAtMMg.7M0JMJEbFeR4Wxl_DeTM2k1Bg2gGbvzZW2KxADRvAtcg.PNG.depeix/image.png?type=w966)<br></br> 

- nmap이 각 포트를 찾았을 때 서비스에 적합한 프로그램들을 자동으로 실행한 결과들을 보여준다.<br></br> 
![](https://postfiles.pstatic.net/MjAyMDExMjBfNjcg/MDAxNjA1ODQ4MjUxMjM2.zUe7lKTdQ4FHlJbEN2DxokjoSwL_hw0C_EOudF6B9xAg.PcgL09dDqbgB9-ztJ-euuHab6GfGhf7oB2JuC2E-MWgg.PNG.depeix/%EC%A0%9C%EB%AA%A9_%EC%97%86%EC%9D%8C.png?type=w966)<br></br> 

- 메타스토이터블 mysql 서비스에 root라는 사용자가 있다는 걸 알아냈다.<br></br> 
![](https://postfiles.pstatic.net/MjAyMDExMjBfMTk0/MDAxNjA1ODQ4MzMwNTk2.kbPW7qvPLO_O4T2xc2sD_vM18iGV8HSX52-gYZDV9aEg.7KNLbamLwurXcV1amhh5nwCPajfum2jW9I-mxC092Lcg.PNG.depeix/image.png?type=w966)<br></br> 

- 실제로 로그인 한 모습이다.<br></br> 

# 네트워크 스니핑
- 네트워크 트래픽을 도청하는 기법
- 대표적인 패킷 애널라이저(packet analyzer)
  - Wireshark
  - tcpdump
- 정보수집
- 서비스 분석
- 사용자 계정 정보 탈취

# Wireshark
Wireshark는 대표적인 패킷분석 도구이다.<br></br>
![](https://postfiles.pstatic.net/MjAyMDExMjFfMjUz/MDAxNjA1OTM2MTYxNTY5.X6t0IXDbVweFFRHhmiM8qQ7kvWvBNS6Cc9tH8Jlymv8g.XAUGkUf6fvrpkk_uGq3dXS42CkFLKEp7y08GtBiDZLcg.PNG.depeix/image.png?type=w966)<br></br>
우선 Wireshark를 실행해보자
<br></br><br></br>
![](https://postfiles.pstatic.net/MjAyMDExMjFfMjM2/MDAxNjA1OTM2MzA1MjI0.FJtU5VpqNFQfYRrn9n6hPxQhttbNbViMKer3k4MIGjYg.FxhNRVTvnRVOtQ727VSwiwVTXb0rzCzPhnURDP_Tutog.PNG.depeix/image.png?type=w966)<br></br>
실행을 하게 되면 어떤 네트워크의 패킷을 분석할지 선택할 수 있다. 우선 메타스플릿테이블에 패킷을 분석하기 위해 eth1을 선택해주자<br></br><br></br>
![](https://postfiles.pstatic.net/MjAyMDExMjFfMjI2/MDAxNjA1OTM2Mzc2OTk0.jRlvQYoJAmBzVCI5EHv5gIASeSDKm1GfWS9R59IZqmog.Q6lWDs_Mt66UfPxOgtiuOpMP96Rqk-vgwi7zBEijoAIg.PNG.depeix/image.png?type=w966)<br></br>
이렇게 메타스플릿테이블에 방문하게 되면 네트워크 패킷이 Wireshark에 캡쳐되게 된다.
Wireshark에서 Source와 Destination은 어디서 출발하여 어디로 도착했는지를 보여준다.
<br></br><br></br>
![](https://postfiles.pstatic.net/MjAyMDExMjFfMjc2/MDAxNjA1OTM2Njg4NjEx.kaG1iC7nU3b2vrdPKbkk0dGuSGgOYjSpS5oezUGzaosg.EFQtLeX7vViZD41FAzrPTIjms5cHWW7uRaSl3xHe_tsg.PNG.depeix/image.png?type=w966)<br></br>
http의 3 way hand-shaking을 확인할 수 있다.<br></br><br></br>
![](https://postfiles.pstatic.net/MjAyMDExMjFfNDEg/MDAxNjA1OTM3NjEwMDA4.IMTIVYCqxrIY5Ub6rgaKJGxcQuV6CLIAu3rWLR27FXwg.pEpTWPBRNNPsQ3pAMi-6kH0rajPU6sFbtCiUkDt5CEkg.PNG.depeix/image.png?type=w966)<br></br>
필터링을 통해 내가 원하는 패킷을 볼 수 있다. ex) ip.addr, tcp.port
<br></br><br></br>
![](https://postfiles.pstatic.net/MjAyMDExMjFfMTc2/MDAxNjA1OTM3OTg5NTcw.z_yRm577dF5a7RfRWusH9htOEZHCK3CV9omIEdZGsXwg.jcp_t4cHxh7YUAiaRAaFJh0Z_HTrTWTtWvcG1rH5uAMg.PNG.depeix/image.png?type=w966)<br></br>
Wireshark를 통해 password를 알아내는  실습을 해보자
우선 메타스플릿테이블에 phpmyadmin(DB서버)를 사용한다.
username, password 아무거나 입력하고 패킷을 확인해본다.
입력은 POST방식으로 하니 phpmyadmin에서 POST 패킷을 확인한다.<br></br><br></br>
![](https://postfiles.pstatic.net/MjAyMDExMjFfMzkg/MDAxNjA1OTM4MTE5ODU2.GPAJ6Qp7JzNcwZAWYHEGZYtxhN8Zmq2YkL-MK_eJIkIg.9curmEtDPFGoNezJlN0RrrswONAiahoOk7fZU7ltC4Qg.PNG.depeix/image.png?type=w966)<br></br>
패킷 우클릭 후 TCP Stream 이나 HTTP Stream을 실행하면 패킷이 데이터화되어서 나오게 된다.<br></br><br></br>
![](https://postfiles.pstatic.net/MjAyMDExMjFfMjI3/MDAxNjA1OTM4MjM3MDQ2.EoFxT60os8wDfAakgMZz9a3APyENW3CjcdXgd4DUPv8g.rC96e3m4C3bXpWMewRB8N_ulnfBEIPvAxFm4v6G1a9Ig.PNG.depeix/image.png?type=w966)<br></br>
데이터에서 내가 입력한 username과 password가 나오게 된다.<br></br><br></br>

# MITM 중간자 공격
- Man In The Middle attack
- 다른 호스트간의 트래픽을 캡쳐하고 조작하는 것
- ARP 캐쉬 포이즈닝 = ARP 스푸핑

# ARP 스푸핑
- 근거리 통신망(LAN)에서 ARP의 취약점을 이용해 데이터를 가로채는 중간자 공격 기법
- 원리
  - LAN에서 네트워크 장비의 IP 주소와 MAC 주소는 ARP 프로토콜을 이용해 대응된다.
  - 공격자가 중간에서(LAN 하에서) 특정 IP 주소와 공격자의 MAC 주소인 ARP 패킷을 발송한다.
  - 이 패킷을 받은 네트워크 장비는 IP 주소를 공격자의 MAC 주소로 인식한다.
  - 스푸핑 당한 네트워크 장비로 보내는 패킷은 공격자의 PC로 전달된다.
  - 공격자는 이 패킷을 도청 혹은 변조할 수 있게된다.
  <br></br>
- 방법
  - arp -a 명령어를 통해 ARP Table의 값을 알아낸다.
  - 우선 echo 1 > /proc/sys/net/ipv4/ip_forward를 작성하여 희생자가 눈치채지 못하게 포워딩을 해준다.
  - gateway의 ip와 MAC주소를 알았으니 arpspoof를 이용해 공격한다.
  - arpspoof -t <target> <gateway>

# Metasploit
- 모의해킹을 위한 통합 플랫폼 스캔부터 취약성 분석, 공격, 보고서 작성까지 모든 기능을 제공하는 작은 스크립트로 시작한 이후 천여개가 넘은 exploit을 제공하는 큰 프로젝트가 되었고 무료 유로로 나뉘어 개발중이다.

## 실습
![](https://postfiles.pstatic.net/MjAyMDExMjZfMTYy/MDAxNjA2MzkyODE1MTU5.CcS0385qtrxq6sVt4MhaxZHHROWHIcg1HsPpmttaSEgg.b_ychcxPWlr0-tL1U6NfIFCKWERABWcbFiHT4lPr4Fkg.PNG.depeix/image.png?type=w966)
- 우선 postgresql 기반 db를 사용하기 때문에 postgresql을 가동하고 초기화까지 해준다.

![](https://postfiles.pstatic.net/MjAyMDExMjZfNDcg/MDAxNjA2MzkyODg2NzQ5.4oFTrDDe1iQfv70qGJwCvdujvS9gL2SobULd6K9YTjYg.NlGw7HWbUGJHlyN7Fv-Yw1-OVjnRwKrjWkYm7SUYqVYg.PNG.depeix/image.png?type=w966)
msfconsole을 통해 metasploit을 실행해준다. 
- 우선 현재 metasploit에 2045개의 exploits 공격모듈, 1106개의 보조모듈, 344개의 post 모듈
- 562개의 payloads, 45개의 encoders, 10개의 nops가 있다. 
- exploits 모듈은 실제로 해킹에 취약하여 해킹시도에 활용되는 모듈이다. 
- 보조모듈은 일종의 공격모듈이지만 주로 스캐닝을 위해 사용되고 payloads를 실행하지 않는다.
- payload = exploit이 성공하면 실행되는 코드 ex) 바인드쉘, 리버스쉘
- encoders 모듈은 payloads를 제대로 타겟까지 전달하기 위한 모듈이다.
- nops 모듈은 어셈블리를 이용해 payloads 값을 일정하게 유지시켜주는 모듈이다.

![](https://postfiles.pstatic.net/MjAyMDExMjZfMjI1/MDAxNjA2Mzk3NjAxNzM5.Bg4tuzYWR2uaL_1Dy_NSrFNcRy0dyJN7nJ3y7KubHMog.Qw5QWUxN44-uTLs6S_o-tkzoUzY-Ph_d783t14zPSWkg.PNG.depeix/image.png?type=w966)
- help를 통해 명령어를 볼 수 있다.

![](https://postfiles.pstatic.net/MjAyMDExMjZfMTU4/MDAxNjA2Mzk3Njg5OTY4.vP9uomkgYcvOdC5ipHs97BspWfrioLI1YBSqyXpiMfEg.Ulq1Itdm0zpmAwKw0QQZdpFuGvItFDMb4OLI7UiH0Fwg.PNG.depeix/image.png?type=w966)
- db_nmap : nmap으로 알아낸 정보를 db에 작성함

![](https://postfiles.pstatic.net/MjAyMDExMjZfMTI2/MDAxNjA2Mzk3NzU0NTMy.nnAQuiu0ZWxg3EdAfbjjnSihwqLdtkH5wId_shFSQ64g.GQLD2GJ_IIWKFdHJ0QhQVLAIx9pVJX79I_nJFsKmU1gg.PNG.depeix/image.png?type=w966)
- services를 통해 nmap의 정보를 볼 수 있다.

![](https://postfiles.pstatic.net/MjAyMDExMjZfNjQg/MDAxNjA2Mzk3ODQ5NDg0.FZwHSLUKXmABW8VtkLYSNh-sjX1pkrjo9s_ZMtn2KwQg.cfGgkTkprjLJ_EEKelpr36XhzOe7IkAegMZPQR4svOMg.PNG.depeix/image.png?type=w966)
- search는 알아낸 정보를 가지고 관련 모듈을 확인할 수 있다.
- 속도가 느리다면 db_rebuild_cache를 이용해 백그라운드 작업을 해주자.

![](https://postfiles.pstatic.net/MjAyMDExMjZfMjcx/MDAxNjA2Mzk4NjAyMTIz.V33ZjFUVhEEj0PhZi2K0-e1929muhBL3a0tT_JtktzUg.wlORV531_AWkGMF9jED0v97pioYyv-SQDXDpJaMVPiMg.PNG.depeix/image.png?type=w966)
- 알아낸 정보를 use 명령어를 통해 사용해주고 필수적으로 설정해야 할 옵션들을 보자

![](https://postfiles.pstatic.net/MjAyMDExMjZfMTEx/MDAxNjA2Mzk4NzIyMzY1.MCv43HjWR-bjO7B9hJuEQUrqkNNLWIbEhH52PR8pAzIg.HfzQWwcwT8uPGY_Lb8pmVSjsdGz2s7EMMEWJB-RCaaQg.PNG.depeix/image.png?type=w966)
- host를 metaspolit ip로 적어주고 다시 옵션을 보면 바뀐걸 볼 수 있다.

![](https://postfiles.pstatic.net/MjAyMDExMjZfMTcw/MDAxNjA2NDAwOTI2OTY0.cHqD0L17tbmYyK-7XTwWNN5qvc5NR6ZBoW5QNm4T5igg.UENsgzz_TUUoW2Q9XfGxnWYc5zufGS4ps2ZxPhhH5Jcg.PNG.depeix/image.png?type=w966)
- run 명령어로 공격을 할 수 있고 
- id를 입력해보면 root 권한이 있는  쉘을 해킹했다.
- ctrl + z 로 백그라운드로 전환해주고 
- sessions -v 으로 session id를 알아내고
- sessions -i [id] 를 통해 언제든지 쉘을 불러올 수 있다.
- 세션 종료는 sessions -k [id]를 사용한다.











