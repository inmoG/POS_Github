# NTFS

NTFS는 윈도우 NT, 2000, XP, 7, 10 등에서 사용하는 기본 파일시스템이다.
그리고 신뢰성, 보안 그리고 대용량 장치를 지원하기 위해 설계되었다
특정 내용으로 데이터 구조체를 감싸는 포괄적인 데이터 구조체를 사용해서 확장성을 제공한다.

# 특징

## 모든 것이 파일

NTFS의 가장 중요한 개념은 종요한 데이터가 파일로 할당된다는 것이다.
다른 파일시스템에서는 파일시스템 레이아웃에 숨겨져있는 기본적인 파일시스템의 관리 데이터가 파일로 저장된다. 관리 데이터를 포함하는 파일들은 일반 파일처럼 볼륨 어느 곳이든 위치할 수 있다.그래서 NTFS 파일시스템은 다른 파일시스템같이 특정 레이아웃을 갖지 않는다. 전체 파일시스템은 데이터 영역으로 간주되고 어떠한 섹터도 파일에 할당될 수 있다.

## USN 저널

USN 저널은 NTFS를 사용하는 볼륨에서 파일의 변경 내용을 기록하는 로그다.
특정 작업을 하던 중 예기하지 못한 시스템 오류가 발생하는 경우, USN 저널은 변경되는 모든 부분을 기록하고 있다가 시스템이 재부팅될 때 완료하지 못한 적업을 복원한다.

## ADS

NTFS는 파일 이름, 소유자, 시간 정보 등을 속성이라는 스트림(바이트 배열)을 통해 표한한다. 데이터 역시 하나의 데이터 스트림으로 표현된다. 보통 파일 당 하나의 데이터 스트림을 가지는데 ADS는 파일 당 하나 이상의 데이터 스트림을 저장할 수 있도록 지원하는 것이다. 일반적으로 데이터 스트림은 이름이 없다. 파일 이름을 표현하는 것은 $FILE_NAME 속성에서 표현되어 따로 $DATA 스트림이 이름을 가질 필요가 없다. 하지만 ADS는 기존 \$DATA에 추가되므로 고유한 이름으로 접근한다.
추가된 ADS 는 "filename: streamname" 과 같이 표기하고 원본파일 이름(filename) 에 ADS(streamname) 을 표현한다.
ADS들의 크기는 파일 크기에 포함되지 않는다. 기존 파일에 1MB 데이터스트림을 추가하더라도 파일크기는 변하지 않는다. 그리고 탐색기를 통해 내용을 확인할 수 없다. ADS는 NTFS의 고유한 특징이기 때문에 네트워크나 USB를 통해 다른 파일시스템으로 전송하면 원본 스트림만 전송되어 복제되지 않는 특징이 있다.

## Sparse 특징

Sparse 특징은 파일 데이터가 '0'일 경우 실제 데이터를 기록하지 않고 크기 정보만 유지하는 파일을 의미한다. 따라서 공간을 절약하는데 많은 도움을 준다.

## 파일 압축

NTFS에서는 파일시스템 수준의 압축을 지원한다. 파일 및 디렉터리 별로 압축하여 저장할 수 있으며 압축 방식은 LZ77의 변형된 방식을 사용한다.

## VSS (Volume shadow Copy service)

VSS는 새롭게 덮여 쓰인 파일과 디렉터리에 대해 백업본을 유지하는 기능이다. 저장된 백업본은 비정상적인 종료시 부팅과정에서 시스템의 저널정보와 함께 안전한 복구를 할 수 있게 도와준다.

## EFS(Encrypting File System)

EFS는 NTFS상에서 파일 및 디렉터리를 암호화 하는 기능이다. CryptoAPI와 EFS File System Run Time Library를 사용한 대칭기 방식으로 암호화 한다.

## Quotas

다중 사용자를 지원하는 환경에서 각 사용자의 디스크 사용량을 제한할 수 있는 쿼터 기능을 지원한다.

## 유니코드 지원

NTFS는 파일, 디렉터리, 볼륨 등의 이름을 지정 시 모듀 유니코드를 사용한다.

## 동적 배대ㅡ 클러스터 재할당

배드 섹터가 발생한 클러스터는 사용할 수 없다. 따라서 시스템 사용 중 배드섹터가 발생한다면 자동으로 새로운 클러스터를 할당해정상 데이터를 복사하는 기법이다. 배드 섹터가 발생한 클러스터는 \$BadClus 파일에 추가되어 사용되지 않는다.
