# 커넥션과 포트번호
## 4계층의 역할과 개요
- 4계층의 역할: 신뢰성이 높은 데이터 전송하기 위한 처리.(에러복구)
(3계층까지는 수신처 자체가 존재하지 않거나 데이터가 도중에 손실됐거나 에러에 의해 파기됐다는 등의 문제들은 신경 쓰지 않음.)
-  **애플리케이션**: 통신에서 데이터를 주고받는 컴퓨터 소프트웨어.
- **흐름제어**: 도달했을 때, 대기장소에 데이터가 넘치는 것을 방지.
- **포트번호**: 어느 애플리케이션이 송수신할지를 결저하는 번호.
- 4계층은 TCP와 UDP 두 가지 프로토콜이 있으며, 둘 중 한개를 사용하여 데이터 전송을 수행.

## 커넥션과 세그먼트
- **커넥션**: 애플리케이션 간의 송수신을 하는 데이터의 길.
- **커넥션 확립**: 가상의 통신로를 만들어 내는 것.
(TCP에서의 데이터 전송에는 커넥션 확립이 필요.)
- TCP 헤더 - 포트 번호, 시퀸스 번호, 플래그 등 약 20옥텟.
- **쓰리웨이 핸드쉐이크**: 3번의 데이터 송수신으로 쌍방향 통신로를 확립.
- 커넥션의 확립은 **쓰리웨이 핸드쉐이크** 방식으로 수행.
- **시퀸스 번호**: MSS 사이즈로 데이터를 분할한 선두 번호.
- 전송되는 데이터에는 순서대로 번호가 부여.

## 윈도우 제어
- **확인 응답**: 세그먼트를 수신하면, 수신한 것을 송신처에게 전달.
(확인응답에 따라 재전송을 수행항 에러를 복구.)
- 시퀸스 번호는 보내는 데이터의 앞부분에 있는 옥텟 번호이고 확인응답 번호는 다음에 받고 싶은 데이터의 선두 옥텟 번호.
- **RTT**: 지금까지 보낸 데이터에 대해 확인응답이 돌아오기까지 걸린 시간으로 계산.
- 연속해서 세그먼트를 보냄으로써 효율 좋은 전송을 수행.
- TCP는 흐름제어의 하나인 **윈도우 제어**는 일단 수신한 데이터를 일시적으로 보관해 두는 버퍼가 있어 버퍼 사이즈를 전함으로써 송신할 수 있는 데이터양을 알려줌으로써 버퍼 플로를 방지.
- 상대방의 버퍼 사이즈 = 윈도우 사이즈를 확인하면서 수행.
- 윈도우 사이즈 분량까지는 확인 응답을 수신하지 않아도 한번에 보낼 수 있음.

## 포트 번호
- **포트 번호**: 어느 애플리케이션으로부터 송신되었는지 어느 애플리케이션 수신인지를 결정.
(포트 번호로 데이터를 보낼 애플리케이션을 특정 = 애플리케이션의 번호.)
- 수신처의 포트 번호를 모르면 데이터를 보낼 수 없음.
- 포트와 애플리케이션을 접속하는 기능을 소켓이라 함.
- **웰 노운 포트**: 65536개의 포트번호중 0~1023번 까지의 번호.
- 송신처는 49152번 이후의 중복되지 않는 번호를 자유롭게 사용.

## UDP
- **UDP 헤더** - 포트 번호 이외에 별다른 항복이 존재하지 않음.
- UDP 는 아무런 제어도 하지 않고 커넥션도 설정하지 않음.
- UDP 는 아무것도 하지 않는 프로토콜이며 장점이자 최대 특징이 '고속'임.
- UDP 는 고속성이나 실시간 송수신이 필요한 애플리케이션과 브로드캐스트가 필요한 애플리케이션에 사용.

## 네트워크 주소 변환
- **글로벌 IP 주소**: ICANN 관리하에 IP를 유일하게 관리하기 위해 있는 주소.
- **사설 IP 주소**: 인터넷에 접속하지 않는 네트워크를 위해 사용할 수 있는 주소.
- **네트워크 주소 변환**(=NAT): TCP/IP를 사용한 통신을 하기위해 내부 네트워크는 사설 IP 주소를 할당하는데 인터넷을 할때는 글로벌 IP 주소로 변환하는 것.(주소 변환)
(단, 동시 접속 수의 문제가 있음.)

## NAPT
- NAPT 장점
    - 하나의 글로벌 IP 주소로 복수의 컴퓨터를 접속 가능.
    - 포트번호도 변환함으로써 복수의 컴퓨터와 동시 접속 가능.
    - NAT 테이블에 없는 변환은 변환되지 않기 때문에 내부 네트워크에 흐르지 않음.
- NAPT 단점
    - NAPT 테이블에 저장되어 있지 않는 것은 LAN 내부에 들어오지 못함.
    - 데이터 부분에 쓰여져 있는 주소는 변환되지 않기 때문에 FTP는 연결되지 않게 됨.

## 5 ~ 7 계층
- 5계층의 역할: 애플리케이션 간의 의논의 관리.
(세션 = 애플리케이션 간의 '말'을 '대화'로써 관리 = 다이얼로그 제어) 
- 6계층의 역할: 컴퓨터간의 데이터 형식을 변환해서 하드웨어랑 OS에 따른 차이를 없앤 데이터 교환.
(애플리케이션과는 동떨어진 데이터 형식의 전송을 위한 변환)
- 7계층의 역할: 애플리케이션의 목적에 따라 네트워크 서비스를 제공.
(애플리케이션의 목적에 따라 사용되는 프로토콜이 정해짐.)

## OSI 참조 모델과 요약
- 5~7계층 - 서비스, 데이터 형식, 세션 관리
- 4계층 - 애플리케이션의 식별, 신뢰성의 유무 결정
- 3계층 - 어드레싱과 라우팅에 의해 인터넷 작업을 수행
- 1~2계층 - 케이블 신호에 의한 데이터 전달과 네트워크 내의 기기에 의한 데이터 전송.
- 각 계층은 상위 계층에 서비스를 제공함.
- 각 계층은 독립해 있으며, 다른 계층에 영향을 미치지 않음.