# 네트워크의 이해
<br>

- OSI 7계층

    - 지금까지도 쓰이고 있는 중요한 네트워크 표준 모델이다.

    - 네트워크과 관련된 일을 하거나 IT 분야의 직업을 가진다면 필요한 개념이다.

<br>

## 물리 계층(1계층)
<br>

: 시스템 간의 연결을 의미하는 것이다.

- 직관적으로 가장 쉽게 이해할 수 있다.

- 전자 파장을 전달하는 공간 또는 물질 자체가 물리 계층이다.

- 물리 계층은 간단하지만 네트워크에서 가장 중요하다.

<br>

## 데이터 링크 계층(2계층)
<br>

: 두 포인트 간의 신뢰성 있는 전송을 보장하기 위한 것이다.

- CRC 기반의 오류 제어 및 흐름 제어가 필요하다.

- 네트워크 위의 개체 간에 데이터를 전달한다.

- 물리 계층에서 발생할 수 있는 오류를 찾아내고 수정하는 데 필요한 기능적/절차적 수단을 제공한다.

- 데이터 링크 계층에서는 상호 통신을 위해 MAC 주소를 할당받는다.

        MAC 주소 : 사람의 이름처럼 네트워크 카드마다 붙는 고유한 이름이다.

<BR>

> 스위치
- 데이터 링크 계층의 대표적인 네트워크 장비이다.

<BR>

> 이더넷
- MAC 계층에서 동작하는 대표적인 프로토콜이다.

<BR>

### 1. 스위치의 동작 원리
<BR>

- 스위치의 메모리에 포트별로 MAC 주소가 매칭된 테이블이 존재하고 이것이 업데이트 된다는 점은 매우 중요하다.

- 데이터 링크 계층 장비인 스위치는 네트워크 계층 정보인 IP 정보를 네트워킹에 활용하지 않는다.

- 패킷 송신 컴퓨터에서 패킷 수신 컴퓨터까지의 흐름은 아주 간단한 매커니즘이다.

<BR>

## 네트워크 계층(3계층)
<BR>

- 여러 개의 노드를 거칠 때마다 경로를 찾아주는 역할을 한다.

- 다양한 길이의 데이터를 네트워크를 통해 전달한다.

- 여러 개의 노드를 거쳐 경로를 찾기 위한 주소는 IP가 대표적이다.

    - 이 IP는 흔히 말하는 TCP/IP에서의 IP다.

<BR>

### 1. 네트워크 계층에서의 패킷 전달 구조
<BR>

- 시스템에서 생성된 패킷이 실제로 어떤 프로세스를 거쳐 인터넷으로 나가는지를 잘 살펴봐야 한다.

- 패킷에는 데이터 링크 계층 통신을 위한 목적지와 출발지의 MAC 주소, 네트워크 계층 통신을 위한 목적지와 출발지의 IP 주소가 기록된다.

    - 목적지 주소 : 목적지를 찾아가기 위한 것이다.

    - 출발지 주소 : 목적지 시스템으로부터 응답 패킷을 받기 위한 것이다.

<BR>

## 전송 계층(4계층)
<BR>

- 양 끝단의 사용자들이 신뢰성 있는 데이터를 주고받을 수 있도록 하여 상위 계층이 데이터 전달의 유효성이나 효율성을 신경 쓰지 않게 해준다.

- 시퀀스 넘버 기반의 오류 제어 방식을 사용하여 특정 연결의 유효성을 제어한다.

- 전송 계층이 패킷의 전송이 유효한지 확인하고 전송에 실패한 패킷을 다시 전송한다.

<BR>

> TCP

: 패킷을 주고받기 전에 미리 연결을 맺어 가상 경로를 설정하는 연결 지향형 프로토콜이다.

- 가장 잘 알려진 전송 프로토콜이다.

- TCP도 포트라는 주소를 가지고 있다.

        포트 : 시스템에서 구동되는 응용 프로그램은 네트워킹을 하기 위해 자신에 해당되는 패킷을 식별할 때 필요하다.
- 수신 측이 데이터를 흘려버리지 않도록 데이터 흐름 제어와 전송 중 에러가 발생하면 자동으로 재전송하는 에러 제어 기능을 한다.

<br>

> UDP 
- 또 다른 전송 계층 프로토콜 중 하나이다.

- TCP와 달리 데이터의 신뢰성 있는 전송을 보장하지 않는다.

<BR>

## 세션 계층(5계층)
<BR>

- 양 끝단의 응용 프로세스가 통신을 관리하는 방법을 제공한다.

        전송 계층이 끝단 간의 논리적인 설정을 담당한다면 세션 계층은 이런 연결에 정보 교환을 효과적으로 할 수 있도록 추가 서비스를 한다.

<BR>

## 표현 계층
<BR>

- 코드 간의 번역을 담당한다.

- 사용자 시스템에서 데이터 구조를 하나의 통일된 형식으로 표현하여 응용 프로그램 계층의 데이터 형식 차이로 인한 부담을 덜어주는 것이다.

<BR>

> ASN.1 방식
- 응용 프로그램 계층 간의 서로 다른 표현을 인식하기 위해 정보를 정의하고 데이터의 압축과 암호화 기능을 수행한다.

         데이터 압축 : 전송되는 데이터 용량을 줄이는 것이다.

         암호화 : 일반 평문을 의미 없는 다른 문자로 만들어 중간에 유출되더라도 원문을 이해할 수 없게 만드는 것이다.

<BR>

## 응용 프로그램(7계층)
<BR>

- 사용자나 응용 프로그램 사이에 데이터 교환이 가능하다.

- 응용 프로세스와 직접 관계하여 일반적인 응용 서비스를 수행한다.

<BR>

# 서비스 거부 공격 : DoS와 DDoS
<br>

- 서비스 거부 공격 : 다른 해킹에 비해 비교적 간단한 것이다.

    - 일종의 훼방이다.
- 분산 서비스 거부 공격 : 광범위한 네트워크를 이용하여 다수의 공격 지점에서 동시에 한곳을 공격하는 형태의 서비스 거부 공격이다.

<br>

## 서비스 거부 공격(DoS)
<br>

### 1. 취약점 공격형
<br>

- 공격 대상이 특정 형태의 오류가 있는 네트워크 패킷의 처리 로직에 문제가 있을 때 그것을 이용하여 오작동을 유발하는 형태로 이루어진다.

<br>

> 보잉크, 봉크, 티어드롭 공격

: 공격 대상이 반복적인 재요청과 수정을 계속하게 함으로써 시스템 자원을 고갈시키는 공격이다.

- 프로토콜의 오류 제어 로직을 악용하여 시스템 자원을 고갈시키는 방식이다.

        티어드롭 : 패킷의 시퀸스 넘버와 길이를 조작하여 패킷 간의 데이터 부분이 겹치거나 빠진 패킷을 전송하는 공격 방법이다.

<br>

> 랜드 공격

: 시스템을 나쁜 상태에 빠뜨리는 것이다.

- 방법도 간단하다.

- 패킷을 전송할 때 출발지 IP 주소와 목적지 IP 주소의 값을 똑같이 만들어서 공격 대상에게 보내는 것이다.

- 이때 조작된 목적지 IP 주소는 공격 대상의 IP 주소여야 한다.

        랜드 공격에 대한 보안책
        
        -  주로 운영체제의 패치 관리를 통해 마련한다.
        
        - 이때 네트워크 보안 솔루션에는 출발지 주소와 목적지 주소의 적절성을 검증하는 기능이 있다.

<BR>

### 2. 자원 고갈 공격형
<BR>

: 네트워크 대역폭이나 시스템의 CPU, 세션 등의 자원을 소모시키는 형태이다.

<BR>

> 죽음의 핑 공격

: NetBLOS 해킹과 함께 시스템을 파괴하는 데 가장 흔히 쓰인 초기의 DoS 공격 방법이다.

- 네트워크에서도 전송하기 적당한 크기로 패킷을 잘라서 보내는 특성이 있다.

        죽음의 핑 공격을 막는 방법
        
        - 죽음의 핑 공격을 막으려면 ping이 내부 네트워크에 들어오지 못하도록 방화벽에서 ping이 사용하는 프로토콜인 ICMP를 차단해야 한다.

<BR>

> SYN 플러딩 공격

: 존재하지 않는 클라이언트가 서버별로 한정된 접속 가능 공간에 접속한 것처럼 속여 다른 사용자가 서비스를 제공받지 못하게 하는 것이다.

- 동시 사용자 수 제한을 이용하는 것이다.

- TCP의 연결 과정인 3-웨이 핸드셰이킹의 문제점을 악용하는 것이다.

- 어떤 사회적인 이슈로 특정 웹 서버의 접속자가 폭주하여 서버 접속이 되지 않고 마비되는 경우도 SYN 플러딩 공격을 받은 상황과 유사하다고 할 수 있다.

        SYN 플러딩 공격의 대응책

        - SYN Received의 대기 시간을 줄이는 것이다.

        - 침입 방지 시스템과 같은 보안 시스템을 통해서도 공격을 쉽게 차단할 수 있다.

<br>

> HTTP GET 플러딩 공격

: 공격 대상 시스템에 TCP 3-웨이 핸드셰이킹 과정으로 정상적으로 접속한 뒤 특정 페이지를 HTTP의 GET 메소드를 통해 무한대로 실행하는 공격이다.

<BR>

> HTTP CC 공격
- HTTP 1.1 버전의 CC 헤더 옵션은 자주 변견되는 데이터에 새로운 HTTP 요청 및 응답을 요구하기 위해 캐시 기능을 사용하지 않도록 할 수 있다.

<BR>

> 동적 HTTP 리퀘스트 플러딩 공격

: 지속적으로 요청 페이지를 변경하여 웹 페이지를 요청하는 기법이다.

        HTTP GET 플러딩 공격이나 HTTP CC 공격은 일반적으로 지정된 웹 페이지를 지속적으로 요청하는 서비스 거부 공격이다.

        그러나 이 두 가지 공격은 웹 방화벽을 통해 특징적인 HTTP 요청 패턴을 방어할 수 있다.

<BR>

> 슬로 HTTP 헤더 DoS(슬로로리스) 공격

: 서버로 전달할 HTTP 메세지의 레더 정보를 비정상적으로 조작하여 웹 서버가 헤더 정보를 완전히 수신할 때까지 연결을 유지하도록 하는 공격이다.

- 그 결과 시스템 자원을 소비시켜 다른 클라이언트의 정상적인 서비스를 방해한다.

<BR>

> 슬로 HTTP POST 공격

: 웹 서버와의 커넥션을 최대한 오래 유지하여 웹 서버가 정상적인 사용자의 접속을 받아들일 수 없게 하는 공격 방식이다.

- 2010년 11월 미국 워싱턴에서 개최된 2010 OWASP AppSecConference에서 소개된 것이다.

- 이 공격은 HTTP POST 메소드를 사용한다.

- 공격자는 소량의 데이터를 느린 속도로 전송하여 웹 서버와의 커넥션이 장시간 유지되게 함으로써 서버의 자원을 잠식한다.

<BR>

> 스머프 공격

- ICMP 패킷과 네트워크에 존재하는 임의의 시스템을 이용하여 패킷을 확장함으로써 서비스 거부 공격을 수행하는 것이다.

- 네트워크를 공격할 때 많이 사용한다.

- 정확하게 스머프 공격을 이해하려면 다이렉트 브로드캐스트를 이해해야 한다.

        브로드캐스트 : 목적지 IP 주소 255.255.255.255를 가지고 네트워크의 임의 시스템에 패킷을 보내는 것이다.
- 스머프 공격은 다이렉트 브로드캐스트를 악용하는 것으로 공격 방법이 간단하다.

        스머프 공격에 대한 대응책

        - 라우터에서 다이렉트 브로드캐스츠를 막으면 된다.

        - 처음부터 다이렉트 브로드캐스트를 지원하지 않는 라우터도 있다.

<BR>

> 메일 폭탄 공격
- 메일 폭탄은 스팸 메일과 같은 종류이다.

- 메일 서버는 각 사용자에게 일정한 양의 디스크 공간을 할당하는데 메일이 폭주하여 디스크 공간을 가득 채우면 정작 받아야 하르 메일을 받을 수 없기 때문이다.

<BR>

## 분산 서비스 거부 공격(DDoS)
<BR>

- 1999년 8월 17일 미네소타대학에서 처음 발생했다.

- 아직까지 확실한 대책이 없으며 공격자의 위치와 구체적인 발원지를 파악하는 것도 불가능하다.

- 과거에는 일종의 자동화된 툴을 이용했는데 광대한 공격 범위를 위해 최종 공격 대상 이외에 공격을 증폭시키는 중간자가 필요했다.

- 과거의 분산 서비스 거부 공격은 공격자가 상당한 시간을 두고 여러 시스템을 해킹하여 시스템에 마스터와 에이전트를 설치하고 공격 시에 해당 시스템에 공격 명령을 내리는 형태였다.

- 따라서 공격울 준비하는 데 오랜 시간이 걸리기 때문에 공격자의 IP가 추적당할 위험이 있고, 네트워크에서 공격 명령을 필터링하여 공격을 중단시킬 수 있다.

- 최근에 발생하는 분산 서비스 거부 공격은 악성 코드와 결합된 형태가 많다.

<BR>

> 분산 서비스 거부 공격의 구성
- 공격자

- 마스터

- 핸들러 프로그램

- 에이전트

- 데몬 프로그램

<br>

# 스니핑 공격
<br>

        sniff : 코를 킁킁거리다.
: 데이터 속에서 정보를 찾는 것이다.

- 공격할 때 아무것도 하지 않고 조용히 있는 것만으로도 충분하기 때문에 수동적 공격이라고도 한다.

<br>

## 스니핑 공격의 원리
<br>

- 네트워크 카드에 인식된 데이터 링크 계층과 네트워크 계층의 정보가 자신의 것과 일치하지 않는 패킷은 무시한다.

<br>

> 프러미스큐어스

: 데이터 링크 계층과 네트워크 계층에서의 필터링을 해제하는 랜 카드의 모드이다.

- 간단한 설정 사항이나 스니핑을 위한 드라이버 설치를 통해 바꿀 수 있다.

<br>

## 스니핑 공격 종류
<br>

### 1. 스위치 재밍 공격
<br>

: 스위치가 MAC 주소 테이블을 기반으로 패킷을 포트에 스위칭할 때 정상적인 스위칭 기능을 마비시키는 공격이다.

- 고가의 스위치는 MAC 테이블의 캐시와 연산자가 쓰는 캐시가 독립적으로 나뉘어 있어 스위치 재밍 공격이 통하지 않는다.

<BR>

### 2. SPAN 포트 태핑 공격
<BR>

- SPAN은 스위치 포트 미러링 기능을 이용한 것이다.

        포트 미러링 
        
        : 각 포트에 전송되는 데이터를 미러링하고 있는 포트에도 똑같이 보내는 것이다.
         
         - 침입 탐지 시스템이나 네트워크 모니터링 또는 로그 시스템을 설치할 때 많이 사용한다.
- 기본적으로 네트워크 장비에서 간단한 성정으로 활성화되지만 포트 태핑은 하드웨어 장비를 이용한다.

<br>

## 스니핑 공격의 탐지
<br>

- 스니핑 공격은 사용자가 이를 인지하기 어려워 능동적인 탐지를 통해서만 잡아낼 수 있다.

- 스니퍼에 대한 탐지는 스니퍼가 프러미스큐어스 모드에서 작동한다는 데에서 시작하면 쉽다.

<br>

> ping을 이용한 스니퍼 탐지
- 의심이 가는 호스트에 ping을 보내면 스니퍼를 탐지할 수 있다.

- 네트워크에 존재하지 않는 MAC 주소를 위장해서 보낸다.

- 만약 ICMP echo reply를 받으면 해당 호스트가 스니핑을 하고 있는 것이다.

<br>

> ARP를 이용한 스니퍼 탐지
- ping을 이용하는 것과 유사한 방법이다.

- 위조한 ARP request를 보냈을 때 ARP response가 오면 프리미스큐어스 모드로 설정되어 있는 것이다.

<br>

> DNS를 이용한 스니퍼 탐지
- 스니핑 프로그램은 사용자의 편의를 위해 스니핑한 시스템의 IP 주소에 DNS에 대한 이름 해석 과정인 Reverse-DNS lookup을 수행한다.

<br>

> 유인을 이용한 스니퍼 탐지
- 보안 관리자는 가짜 아이디와 패스워드를 네트워크에 계속 뿌리고, 공격자가 이 아이디와 패스워드로 접속을 시도할 때 스니퍼를 탐지한다.

<br>

> ARP watch를 이용한 스니퍼 탐지
- ARP watch는 MAC 주소와 IP 주소의 매칭 값을 초기에 저장하고 ARP 트래픽을 모니터링하여 이를 변하게 하는 패킷이 탐지되면 관리자에게 메일로 알려주는 툴이다.

<BR>

# 스푸핑 공격
<BR>

        spoofing : 속이는 것이다.

<br>

## 스푸핑 공격의 종류
<br>

### 1. ARP 스푸핑 공격
<BR>

: MAC 주소를 속이는 것이다.

- 로컬에서 통신하고 있는 서버와 클라이언트의 IP 주소에 대한 데이터 링크 계층의 MAC 주소를 공격자의 MZC 주소로 속여, 클라이언트에서 서버로 가는 패킷이나 서버에서 클라이언트로 가는 패킷이 공격자에게 향하게 함으로써 랜의 통신 흐름을 왜곡한다.

<BR>

### 2. IP 스푸핑 공격
<BR>

: 다른 사용자의 IP를 강탈하여 어떤 권한을 획득하는 것이다.

- 트러스트 관계를 맺고 있는 서버와 클라이언트를 확인한 후 클라이언트에 서비스 거부 공격을 하여 연결을 끊는다.

        트러스트 : 로그인을 할 때 클라이언트의 정보를 서버에 미리 기록해두고 그에 합당한 클라이언트가 접근하면 아이디와 패스워드의 입력 없이 로그인을 허락하는 인증법이다.
- 공격자는 클라이언트의 IP 주소를 확보하여 실제 클라이언트처럼 패스워드 없이 서버에 접근한다.

        IP 스푸핑 공격에 대한 대응책

        - 트러스트를 이용하지 않는 것이다.

        * 취약한 계정 하나가 트러스트로 연결된 구성 서버를 모두 위험에 빠뜨릴 수 있기 때문이다.

<BR>

### 3. ICMP 리다이렉트 공격
<BR>

: 네트워크 계층에서 스니핑 시스템을 네트워크에 존재하는 또 다른 라우터라고 알림으로써 패킷의 흐름을 바꾸는 공격이다.

- 라우터 게이트웨이를 2개 이상 운영하여 로드 밸런싱을 해야 한다.

        로드 밸런싱 : 시스템의 라우팅 테이블에 라우팅 엔트리를 하나 더 넣거나 ICMP 리다이렉트 방법을 이용하는 것이다.

<BR>

### 4. DNS 스푸핑 공격
<BR>

: 실제 DNS 서버보다 빨리 공격 대상에게 DNS response 패킷을 보내어 공격 대상이 잘못된 IP 주소로 웹 접속을 하도록 유도하는 공격이다.

- 때로 웹 스푸핑과 비슷한 의미로 해석된다.

        DNS 스푸핑 공격을 막는 방법

        - 중요 서버에 대해 DNS query를 보내지 않으면 된다.

        DNS 스푸핑 대응책

        - 중요 접속 서버의 URL에 대한 IP를 hosts 파일에 등록해놓으면 된다.

<br>

# 세션 하이재킹 공격
<br>

: 로그인된 상태를 가로채는 것을 말한다.

<br>

> TCP 세션 하이재킹

: TCP가 가진 고유한 취약점을 이용하여 정상적인 접속을 빼앗는 방법이다.

- 서버와 클라이언트에 각각 잘못된 시퀸스 넘저를 사용해서 연결된 세션에 잠시 혼란을 준 뒤 자신이 끼어 들어가는 방식을 사용한다.

        세션 하이재킹을 막는 방법

        - 텔넷과 같은 취약한 프로토콜을 이용해서는 안된다.

        - SSH와 같이 세션에 대한 인증 수준이 높은 프로토콜을 이용하여 서버에 접속해야 한다.

        - 클라이언트와 서버 사이에 MAC 주소를 고정하는 것이다.

<BR>

# 무선 네트워크 공격과 보안
<BR>

- 무선 랜은 유선 랜의 네트워크를 확장하려는 목적으로 사용된다.

- 무선 랜을 사용하려면 내부의 유선 네트워크에 AP 장비를 설치해야 한다.

<BR>

## AP 보안
<BR>

###  1. 물리적인 보안 및 관리자 패스워드 변경
<BR>

- AP는 전파가 건물 내에 한정되도록 전파 출력을 조정하고, 창이나 외부에 접한 벽이 아닌 건물 안쪽 중심부의 눈에 쉽게 띄지 않는 곳에 설치하는 것이 좋다.

- 설치 후에는 AP의 기본 계정과 패스워드를 반드시 재설정해야 한다.

<BR>

### 2. SSID 브로드캐스팅 금지
<BR>

- AP의 존재를 숨기고 싶으면 SSID 브로드캐스팅을 막고 사용자가 SSID를 입력해야 AP에 접속할 수 있게 한다.

- 이때 SSID는 AP 접근을 위한 일차적인 패스워드로 사용될 수 있다.

- 높은 수준의 보안 권한이 필요한 무선 랜은 대부분 SSID 브로드캐스팅을 차단한다.

<BR>

## 무선 랜 통신의 암호화
<BR>

- 무선 랜은 통신 과정에서 데이터 유출을 막는 것뿐만 아니라 네트워크에 대한 인증을 위해서도 암호화를 수행한다.

<BR>

### 1. WEP
<BR>

: 무선 랜 통신을 암호화하기 위해 802.11b 프로토콜부터 적용되기 시작했다.

- 1987년에 만들어진 RC 4 암호화 알고리즘을 기본으로 한다.

- 암호화 과정에서 암호화 키와 함께 24비트의 IV를 사용한다.

- 무선 통신에서 네트워크 패킷에 포함되어 있는 IV를 충분히 수집하여 WEP 키를 크래킹을 할 경우 1분 이내에도 복호화할 수 있다.

<BR>

### 2. WPA-PSK
<BR>

- 802.11i 보안 표준의 일부분으로 WEP 방식 보안의 문제점을 해결하기 위해 만들어졌다.

- 802.11i에는 WPA-1과 WPA-2 규격이 포함되어 있다.

  - WPA-1 규격 : TKIP 암호화 방식

  - WPA-2 규격 : CCMP 암호화 방식 
- WPA 규격은 WPA-개인과 WPA-엔터프라이즈로 구성되어 있다.

  - WPA-개인 : PSK 모드를 사용하는 경우

  - WPA-엔터프라이즈 : RADIUS 인증 서버를 사용하는 경우

<BR>

### 3. EAP와 802.1x 암호화
<br>

- 유선 랜 환경에서 포트 기반 인증 표준으로 사용되는 IEEE 802.1x 표준과 함께 다양한 인증 메커니즘을 사용할 수 있도록 IETF의 EAP 인증 프로토콜을 채택한 것이다.

