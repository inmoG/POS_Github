# 웹 보안

## HTTP

### HTTP Request

웹 서버에 데이터를 요청하거나 전송할 때 보내는 패킷으로, 주로 GET, POST와 같은 메소드를 사용한다.

#### GET 방식

`www.wishfree.or.kr/list.php?page=1&search=test`

이름과 값을 &로 결합해 글자 수를 255자로 제한한다. GET 방식은 데이터가 주소 입력란에 표시된다. 최소한의 보안도 유지되지 않아 매우 취약하다.

#### POST 방식

URL에 요청 데이터를 기록하지 않고 HTTP 헤더에 데이터를 전송해 GET 방식에서의 `?page=1&search=test` 같은 부분이 없다.
인수 값을 URL로 전송하지 않아 다른 사람이 링크를 통해 해당 페이지를 볼 수 없다. 게시판 등에서 파일 업로드는 POST 방식만 가능하다. GET 방식과는 다르게 보내려는 데이터가 URL을 통해서 노출되지 않아 최소한의 보안을 갖춘다. 게시판 목록, 글 보기 화면은 GET방식을 사용하고 글 저장/수정/삭제나 많은 양의 데이터를 전송할 때는 POST 방식을 사용한다.

#### 그 외 방식

- HEAD

- OPTIONS
- PUT
- DELETE
- TRACE

### HTTP Response 방식

`HTTP request`에 대한 응답 패킷이다. 서버에서 쓰이는 프로토콜 버전, `request` 실행결과 코드 실행결과 설명문이 담겨있다.

## OWASP 취약점 (2013)

### 명령 삽입(Injection) 취약점

클라이언트 요청을 처리할 때 전송받는 인수에는 특정 명령을 실행하는 코드가 포함되는 경우가 있다. 이를 필터링하는 처리과정을 수행하지 못하면 삽입 공격에 대한 취약점이 생긴다. 웹서버와 연동되는 데이터베이스에 SQL 명령을 실행하여 데이터를 수집하는 `SQL Injection`공격이 있다.

### XSS 취약점

공격자가 작성한 스크립트가 다른 사용자에게 전달된다. 다른 사용자의 웹 브라우저 내에서 적절한 검증 없이 실행된다. 사용자 세션을 탈취하거나 웹 사이트를 변조하거나 악의적인 사이트로 사용자를 이동시킨다.

### 취약한 인증 및 세션 관리

인증이나 세션관리와 관련된 기능이 올바르게 구현되지 않으면 공격자는 로그인 하지 않은 상태로 서비스 페이지에 접근하거나 다른 사용자 아이디로 접근할 수 있다.

- 취약한 패스워드 설정
- 사용자 측 데이터를 이용한 인증

1. 아이디 패스워드 입력
2. 인증 허용 값 전달받아 세션이 유효한 인증인지 확인
3. 공격자가 전달한 값(아이디 및 사용자 고유번호)을 이용해 인증의 소유자 구분
4. 새로운 웹 페이지 접근
5. UserNo값만 변경해 다른 계정으로 로그인 한 것처럼 웹 서비스 이용가능

### 직접 객체 참조

파일, 디렉터리, DB 키와 같이 내부적으로 구현된 객체의 참조가 노출될 때 발생한다. 접근 통제나 보호 조치가 없다면 공격자는 권한 없는 데이터에 접근하고자 노출된 참조를 조작한다.

- 디렉터리 탐색

  웹 브라우저에서 확인 가능한 경로의 상위로 탐색해 특정 시스템 파일을 다운로드하는 공격 방법이다. 인수 값인 파일 이름에서 특수문자 등의 존재 여부를 필터링 해야한다. `..` , `/` 문자열 필터링이 없으면 공격자가 상위로 올라가 특정파일을 열람할 수 있어 `..` , `/` 문자를 필터링해야 한다.

- 파일 업로드 제한 부재(웹쉘 공격)

  클라이언트에서 서버 측으로 파일을 보내는 취약점이다. 공격자는 웹 서버에 악의적인 파일을 전송하고 원격지에서 해당 파일을 실행해 웹 서버를 장악하면 추가적인 내부 침투 공격이 가능하다. 웹 해킹 최종 목표인 웹 서버 권한을 얻으려면 반드시 성공해야 하는 공격이다. 게시판에 첨부파일로 악의적인 파일을 업로드 해 실행시키며 첨부파일은 웹쉘 악성코드이다.

- 리버스 텔넷

  웹 해킹으로 시스템 권한을 획득한 후 해당 시스템에 텔넷과 같이 직접 명령을 입력해 확인 가능한 쉘을 획득하는 공격 방법이다. 방화벽이 있는 시스템을 공격할 때 사용한다.
  인바운드 정책은 80번 포트와 필요한 포트만 빼고 막아놓지만, 아웃바운드 정책은 필터링을 하지 않는 경우가 많아 리버스 텔넷에 취약하다. exe나 com같은 실행파일 업로드를 막아야 하며 인바운드 뿐만 아니라 아웃바운드의 불필요한 접속을 막아야 한다.

### CSRF 취약점

특정 사용자를 대상으로 하지 않고, 불특정 다수를 대상으로 로그인된 사용자가 자신의 의지와는 무관하게 공격자가 의도한 행위(수정,삭제,동록,송금)를 하게 만드는 공격이다. XSS공격은 악성 스크립트가 클라이언트에서 실행되지만 CSRF공격은 악성 스크립트를 서버에 요청한다. CSRF가 성공하려면 수정, 삭제, 등록하는 액션에서 사용자를 구분하는 파라메터 값이 존재하지 않아야 한다. 사용자를 구분하는 인수가 있으면 하나의 사용자에게만 적용되거나 인증과정을 통해 공격을 막는다.

### 디렉터리 리스팅

웹 브라우저에서 웹 서버의 특정 디렉터리를 열면 그 디렉터리에 있는 파일과 목록이 모두 나열된다.

- 백업 및 임시파일 존재

  웹 서버에 백업 파일이나 임시 파일들을 삭제하지 않은 채 방치하는 경우가 있다. 만약 공격자가 백업 파일을 발견한다면 웹의 내부 로직, DB접속 정보 등 중요 정보를 획득할 수 있다.

- 주석관리 미흡

  개발 과정이나 관리 목적으로 로직에 대한 설명, 디렉터리 구조, 테스트 소스 정보, 아이디와 패스워드 등의 주석은 해커가 웹 프록시로 볼 수 있다.

### 취약한 정보 저장 방식

개인정보처럼 중요 데이터는 암호화 로직을 사용하고, DB 테이블 단위에서 암호화를 수행한다.

### URL 접근 제한 실패

URL 접근 제한 실패는 관리자 페이지가 추측하기 쉬운 URL을 가지거나 인증이 필요한 페이지가 인증 처리를 하지않아 우회하여 접속하는 취약점이다. 일반 사용자나 로그인 하지 않은 사용자가 관리자 페이지에 접근해 관리자 권한을 획득한다. 인증 우회를 막으려면 중요 페이지에 세션 값을 확인하는 검증 로직을 입력한다. 개발자가 만들어놓은 웹 이용 시나리오 중간에 공격자가 끼어들어 인증을 거치지 않고 자신이 원하는 기능을 사용한다. 개발 시 표준 인증 로직을 만들어 웹 모든 페이지 앞부분에 적용한다.

### 인증 시 비암호화 채널 사용

강력한 암호화 알고리즘으로 통신을 암호화 한다. 알고리즘이 약하거나 암호화하는 구조에 문제가 있다면 트래픽이 복호화되거나 위변조된다.

### 부적절한 오류 처리

목적 페이지에 리다이렉트하려고 신뢰하지 않는 데이터를 사용하는 경우가 있다.. 확인 절차가 없으면 공격자는 피해자를 피싱 사이트나 악의적인 사이트로 리다이렉트한다. 권한 없는 페이지 접근에 사용한다.

## 취약점 대응 방법

### 특수문자 필터링

웹 해킹의 가장 기본적인 형태 중 하나가 인수 조작이다. 인수 조작은 특수문자를 사용해 필터링해야 한다.

- 필터링 대상 주요 특수문자

  | 주요 특수 문자 |     주요 공격      |
  | :------------: | :----------------: |
  |       <        |        XSS         |
  |       >        |        XSS         |
  |       &        |        XSS         |
  |       "        |        XSS         |
  |       ?        |        XSS         |
  |       '        | XSS,SQL injection  |
  |       --       |   SQL injection    |
  |       =        |   SQL injection    |
  |       ;        |   SQL injection    |
  |       \*       |   SQL injection    |
  |       .        |   SQL injection    |
  |       ..       |   SQL injection    |
  |       /        | XSS, 디렉터리 탐색 |

### 서버 측 통제 작용

파일 업로드 취약점, 특수문자 필터링을 수행할 때 자바스크립트로 필터링 하면 안된다. 웹 프록시로 전달되는데 이 과정에서 변조될 가능성이 있다. 따라서 백엔드로 필터링을 수행해야 한다.

### 지속적인 세션 관리

URL 접근 제한 실패를 막기 위해선 모든 웹 페이지 세션인증을 수행해야 한다.
